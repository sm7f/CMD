$DBNAME="PoliSystemServerSQLDB"; if ((sqlcmd -S . -U sa -P PoliSystemsapwd -h -1 -Q "SET NOCOUNT ON; IF EXISTS (SELECT name FROM sys.databases WHERE name=N'$DBNAME') PRINT 'EXISTS' ELSE PRINT 'NOTEXISTS'") -match "EXISTS") { Write-Host "⚠️  O banco $DBNAME já está anexado" -ForegroundColor Yellow } else { if (Test-Path "C:\Maqplan\BancoDados\$DBNAME.mdf") { sqlcmd -S . -U sa -P PoliSystemsapwd -Q "EXEC sp_attach_db @dbname=N'$DBNAME', @filename1=N'C:\Maqplan\BancoDados\$DBNAME.mdf', @filename2=N'C:\Maqplan\BancoDados\${DBNAME}_log.LDF'" } elseif (Test-Path "C:\Maqplan\BancoDados\${DBNAME}_Data.mdf") { sqlcmd -S . -U sa -P PoliSystemsapwd -Q "EXEC sp_attach_db @dbname=N'$DBNAME', @filename1=N'C:\Maqplan\BancoDados\${DBNAME}_Data.mdf', @filename2=N'C:\Maqplan\BancoDados\${DBNAME}_log.LDF'" } }; if ($LASTEXITCODE -eq 0) { Write-Host "✅ Banco $DBNAME pronto!" -ForegroundColor Green; sqlcmd -S . -U sa -P PoliSystemsapwd -d $DBNAME -Q "SELECT NomeEmpresa, razaoSocialEmpresa, CNPJEmpresa FROM EMPRESA WHERE CdEmpresa=1"; sqlcmd -S . -U sa -P PoliSystemsapwd -d $DBNAME -Q "SELECT * FROM VERSAO_SISTEMA" } else { Write-Host "❌ ERRO ao anexar o banco $DBNAME" -ForegroundColor Red }
